如何写出更好的代码


# 1. 介绍

这两天要修改其他同事写的一个模块，以实现一些功能优化。在修改之前，必然是要先完整的过一遍这些代码，根据我这一年以来学习的"如何写出更好代码"的积累，可以轻而易举的指出代码中多个可以优化的地方，可以负责任的说，代码写得不好。不好的地方主要有以下几点：

1. 函数太长，约200+行，几乎所有的烂代码都有这个问题
1. 逻辑判断不清晰，例如，有一个条件，在接下来的每一个地方都会出现，那么这个条件就应该在最上层就进行判断
1. 代码多次重复，这也是几乎所有烂代码都存在的问题，之所以代码多次重复，是因为没有将共有的代码提升为一个函数，这个直接导致了"函数太长"的问题
1. if嵌套层次深(3层)，难以理解

这个模块当然也不是一无是处，毕竟不是在校学生写的练习，但是，也确实存在我上面说的这些问题。该模块是一个"资深工程师"写的模块，后来另外一个同事对该模块进行了拓展，我猜想，该模块一开始并没有这么烂，当然也不够好，后来修改的同事刚入职就修改这部分代码，由于不够自信或者不够熟悉，所以不敢"乱改"，因此，后来修改的同事没有做到"让营地比你来时更干净"，这也是几乎所有代码变烂的路数。


此外，还有一个工作了多年的同事，他之前是做C/C++的，最近开始写java，客观的说，写得代码也不够好，例如：

* 他的代码存在很多java里的"小黄线"
* 几乎所有修改都是在"加代码"，而不管代码加完以后变得更加丑陋
* 他工作非常负责，会将修改的jira写到注释里面，也就是说，你要搞清楚这里发生了什么，光看代码或许还不够，还需要看他给出的jira，我就很难接受，为什么不把代码写得清晰明了、简单直接，然后加上适可而止的注释就好了呢。在注释里写上jira号的意思就是：我无法用代码简单的说明这个问题，另外一个地方有更详细的说明，如果你想搞清楚，请移步到我给出的jira


上面提到了三位同事，其实，他们的技术水平都很高，工作年限也比我久，对于代码和业务都比我理解得更为透彻，我也非常尊敬他们，觉得能和他们成为同事非常荣幸。但是，我仍然认为他们写得代码不够好，当然我不是一个喷子，毕竟，我有理有据。既然这些技术水平高、工作年限久、做事又很负责人的优秀同事没有写出优美的代码，那么，为什么这些优秀的工程师没有写出优美的代码?如何才能写出优美的代码呢?


这也是我写这篇博客的原因，讨论一下如何写出优秀的代码。

# 2. 如何写出优秀的代码

** 为什么要写出优美的代码 **

关于"为什么要写出优美的代码"可以找到很多的答案，但是，最重要的理由是：

1. 你是一个程序员
1. 你想成为更好的程序员

** 为什么这些优秀的工程师没有写出优美的代码 **

关于这个问题，我并没有在某本经典的书籍里面找到合适的答案，因此，我试着自己来回答这个问题。

为什么这些优秀的工程师没有写出优美的代码?答案是：写出简洁、优美、恰到好处的代码是一种"*需要刻意习得的技艺*"，就像学习编程一样，你需要刻意的学习"如何写出优美的代码"。每一个优秀的软件工程师，都看过大量的计算机专业书籍，并写了进行了大量的工程实践，而我认为，如果没有刻意学过"如何写出优美的代码"，那么，即使写过再多的烂代码，写无法写出优美的代码。

举个例子：每一个大学生都学过十几年的语文，能够熟练的用汉字写长篇的作文，而国内的论文是由汉字和专业知识组成，是否每一个大学生做完实验都能够写出优秀的论文呢?当然不是！写论文有很多的技巧和规范，有很多需要注意的地方，例如，写论文要先打框架,让读者知道你先讲什么、后讲什么,现在正在讲什么,要让读者对文章有宏观的概念,然后再深入细节；写论文绝对不要出现模凌两可的地方，也不应该出现可能让读者"想歪"的地方，要准确、无误地表达作者的观点。同样一个实验和实验结果，作者的写作水平，完全可以决定这篇论文的层次。

你没有可以学习如何写论文，也有没有一个靠谱的导师教你写论文，那么，你又怎么可能写出高水平的论文呢？写论文如此，写代码又何尝不是这样呢?

** 如何写出优秀的代码 **

在我们的学习生涯中，学习了很多的理论和技术，但是，却没有一门课程教我们，如何写出好的代码，这也是为什么很多工程师无法写出好的代码的主要原因，因为你没有刻意习得写出优美代码的技艺，你甚至不知道什么样的代码是好，什么样的代码是不好，那么，你又如何能够写出好的代码！

所以，写出优美代码的办法就是，找一本讲"如何写出好代码"的书，学习并反复实践。在市面上讲如何写出优美代码的书有《代码整洁之道》和《重构》，都是非常经典值得反复阅读的书，在这两本书中，我更推荐《代码整洁之道》，因为它更详细、简单，更具有可操作性。本文第3节将对这本书进行简单的介绍。

# 3. 写出优美代码的途径

我学习"写出优美代码"的办法就是学习并践行《代码整洁之道》中的"代码味道",并通过不断的反思和重构,来改进已有的代码.通过这一年多的学习和实践，收到了较好的效果。

《[代码整洁之道][1]》教我们如何写出整洁的代码. 这本书让我想起我研究生二年级期间,导师[手把手教我改论文][0]的场景,非常惭愧又非常骄傲的说,林老师手把手教我改论文,是我文字表达能力进步最大的一个阶段,显著提高了我的文字表达能力.而这本书,就是手把手教我写代码的"导师".

![cleanclode](/cn/clean_code.jpg)

这本书教授的内容非常简单,无非是一些琐碎的编程建议,目的就是培养你的"代码味道",教你写出更整洁的代码.这本书适合所有希望写出整洁代码的程序员,适合所有对自己有一定要求的程序员。

**注意:**这本书中的例子使用java写的,这也是为什么我之前就知道这本书但是一直没有提起兴趣看,请不要在意编程语言,书中的建议适合所有的程序员或编程语言.

全书分为三部分:

1. 第一部分是详细的编程建议,详细地说明每条建议的HOW与WHY,教你如何写代码;
2. 第二部分是三个重构的例子,将三个一般的项目重构成优美的项目,对于每一步修改,都给出了修改的原因,这一部分是作者手把手教我们写代码,这种前辈手把手教新手的机会不可多得;
3. 第三部分是总结,作者给出了所谓的"代码味道",是对第一部分与第二部分内容的总结,方便读者参考.


# 后记

我本来是将这篇博客定位于"技术文章",不过感觉都是在扯淡,虽然说的不是具体的技术,但是,写这篇博客耗费了比写技术更多的时间,希望对读者有所帮助.  这篇博客我寻找"如何写出更好的代码"的思考和感悟.  在一本讨论如何写出更好的代码的博客中，居然没有出现一行代码， 

* 没有用一个巧到好处的设计模式，可能是你能力欠缺，没有用一个恰到好处的变量命名，只能说明你对自己要求太低
* 如何警惕自己写出烂的代码，并不需要随时在脑海里搜索哪些写出好代码的策略，只需要时时刻刻记住，你和写书的作者没有什么两样，你也是作者，你需要准确、无误的传达自己的观点，那么，你就应该对读者可能"误会"的地方警惕

1. http://www.cnblogs.com/forlina/archive/2011/06/24/2088603.html
[0]:http://dblab.xmu.edu.cn/post/767/
[1]:http://book.douban.com/subject/4199741/
